<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POC Schema.org - Knowledge Consolidator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h2 {
            margin-top: 0;
            color: #667eea;
            font-size: 1.4em;
        }

        .test-section {
            margin: 20px 0;
        }

        .test-file {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .test-file.enriched {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .file-icon {
            font-size: 24px;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .file-meta {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .schema-type {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8em;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .json-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .metric-label {
            font-weight: 500;
            color: #555;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            text-align: center;
            color: white;
            line-height: 20px;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .container,
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî¨ POC Schema.org - Knowledge Consolidator</h1>
        <p>Demonstra√ß√£o de enriquecimento sem√¢ntico com Schema.org</p>
    </div>

    <div class="card">
        <h2>üìä Status do Sistema</h2>
        <div id="system-status"></div>
        <div class="action-buttons">
            <button onclick="checkSystem()">Verificar Sistema</button>
            <button onclick="loadTestData()">Carregar Dados de Teste</button>
            <button onclick="clearData()">Limpar Dados</button>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h2>üìÅ Arquivos Dispon√≠veis</h2>
            <div id="file-list"></div>
            <div class="action-buttons">
                <button onclick="enrichAllFiles()">Enriquecer Todos</button>
                <button onclick="showComparison()">Comparar Antes/Depois</button>
            </div>
        </div>

        <div class="card">
            <h2>üìà M√©tricas de Enriquecimento</h2>
            <div id="metrics"></div>
            <div class="progress">
                <div class="progress-bar" id="enrichment-progress" style="width: 0%">0%</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>üîç Visualiza√ß√£o JSON-LD</h2>
        <div class="action-buttons">
            <button onclick="exportAsJSON()">Exportar JSON</button>
            <button onclick="exportAsJsonLD()">Exportar JSON-LD</button>
            <button onclick="exportToQdrant()">Exportar Qdrant</button>
            <button onclick="validateSchemas()">Validar Schemas</button>
        </div>
        <div id="json-viewer" class="json-viewer"></div>
    </div>

    <div class="card">
        <h2>üìä Compara√ß√£o: Sem Schema.org vs Com Schema.org</h2>
        <div class="comparison-grid">
            <div>
                <h3>‚ùå Sem Schema.org (Sint√°tico)</h3>
                <div id="before-schema" class="json-viewer"></div>
            </div>
            <div>
                <h3>‚úÖ Com Schema.org (Sem√¢ntico)</h3>
                <div id="after-schema" class="json-viewer"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Importa os m√≥dulos necess√°rios
        const KC = window.KnowledgeConsolidator;
        let testFiles = [];

        // Fun√ß√µes globais para os bot√µes
        window.checkSystem = async function() {
            const status = document.getElementById('system-status');
            status.innerHTML = '<div class="status info">Verificando sistema...</div>';
            
            try {
                // Verifica componentes necess√°rios
                const checks = {
                    'SchemaOrgMapper': !!KC.SchemaOrgMapper,
                    'AnalysisManager': !!KC.AnalysisManager,
                    'RAGExportManager': !!KC.RAGExportManager,
                    'AppState': !!KC.AppState,
                    'Logger': !!KC.Logger
                };

                let allOk = true;
                let statusHtml = '<div class="status success">Sistema pronto!</div>';
                statusHtml += '<div style="margin-top: 10px;">';
                
                for (const [component, available] of Object.entries(checks)) {
                    const icon = available ? '‚úÖ' : '‚ùå';
                    statusHtml += `<div class="metric">
                        <span class="metric-label">${component}</span>
                        <span>${icon}</span>
                    </div>`;
                    if (!available) allOk = false;
                }
                
                statusHtml += '</div>';
                
                if (!allOk) {
                    statusHtml = '<div class="status error">Alguns componentes n√£o est√£o dispon√≠veis</div>' + statusHtml;
                }
                
                status.innerHTML = statusHtml;

                // Testa gera√ß√£o de exemplo
                if (KC.SchemaOrgMapper?.generateExample) {
                    const example = KC.SchemaOrgMapper.generateExample();
                    console.log('Exemplo Schema.org:', example);
                }

            } catch (error) {
                status.innerHTML = `<div class="status error">Erro: ${error.message}</div>`;
            }
        };

        window.loadTestData = function() {
            // Dados de teste representando os 5 analysisTypes
            testFiles = [
                {
                    id: 'test-001',
                    name: 'implementacao-cache-redis.md',
                    content: 'Este documento descreve a implementa√ß√£o de cache distribu√≠do usando Redis para otimiza√ß√£o de performance em microservi√ßos. A solu√ß√£o envolve configura√ß√£o de clusters e algoritmos de eviction.',
                    preview: 'Implementa√ß√£o de cache distribu√≠do com Redis...',
                    analysisType: 'Breakthrough T√©cnico',
                    categories: ['DevOps', 'Arquitetura'],
                    relevanceScore: 0.85,
                    createdDate: '2025-01-20T10:00:00Z',
                    modifiedDate: '2025-01-21T14:30:00Z',
                    analyzed: true,
                    analysisDate: '2025-01-21T15:00:00Z'
                },
                {
                    id: 'test-002',
                    name: 'evolucao-design-patterns.txt',
                    content: 'Uma an√°lise sobre a evolu√ß√£o do entendimento de design patterns, desde Gang of Four at√© padr√µes modernos. Nova perspectiva sobre como aplicar padr√µes em arquiteturas cloud-native.',
                    preview: 'Evolu√ß√£o do entendimento de design patterns...',
                    analysisType: 'Evolu√ß√£o Conceitual',
                    categories: ['Arquitetura', 'Estrat√©gia'],
                    relevanceScore: 0.78,
                    createdDate: '2025-01-18T09:00:00Z',
                    modifiedDate: '2025-01-19T11:00:00Z',
                    analyzed: true,
                    analysisDate: '2025-01-19T12:00:00Z'
                },
                {
                    id: 'test-003',
                    name: 'decisao-migracao-cloud.docx',
                    content: 'Decis√£o estrat√©gica: migrar infraestrutura para cloud. Escolha entre AWS e Azure baseada em an√°lise de custos e capacidades. Dire√ß√£o definida para transforma√ß√£o digital.',
                    preview: 'Decis√£o de migra√ß√£o para cloud...',
                    analysisType: 'Momento Decisivo',
                    categories: ['Estrat√©gia', 'DevOps'],
                    relevanceScore: 0.92,
                    createdDate: '2025-01-15T14:00:00Z',
                    modifiedDate: '2025-01-16T16:00:00Z',
                    analyzed: true,
                    analysisDate: '2025-01-16T17:00:00Z'
                },
                {
                    id: 'test-004',
                    name: 'insight-ai-automation.pdf',
                    content: 'Insight transformador sobre uso de IA para automa√ß√£o de processos. Breakthrough na integra√ß√£o de LLMs com workflows existentes. Potencial de redu√ß√£o de 70% no tempo de desenvolvimento.',
                    preview: 'Insight sobre automa√ß√£o com IA...',
                    analysisType: 'Insight Estrat√©gico',
                    categories: ['IA/ML', 'Estrat√©gia'],
                    relevanceScore: 0.88,
                    createdDate: '2025-01-17T10:00:00Z',
                    modifiedDate: '2025-01-17T15:00:00Z',
                    analyzed: true,
                    analysisDate: '2025-01-17T16:00:00Z'
                },
                {
                    id: 'test-005',
                    name: 'notas-reuniao-sprint.md',
                    content: 'Notas gerais da reuni√£o de sprint. Discuss√µes sobre pr√≥ximas features, bugs encontrados, e aprendizados do ciclo anterior. Documenta√ß√£o padr√£o do processo.',
                    preview: 'Notas da reuni√£o de sprint...',
                    analysisType: 'Aprendizado Geral',
                    categories: ['Dados'],
                    relevanceScore: 0.65,
                    createdDate: '2025-01-19T09:00:00Z',
                    modifiedDate: '2025-01-19T10:30:00Z',
                    analyzed: true,
                    analysisDate: '2025-01-19T11:00:00Z'
                }
            ];

            // Salva no AppState
            KC.AppState?.set('files', testFiles);
            
            displayFiles();
            updateMetrics();
            
            document.getElementById('system-status').innerHTML = 
                '<div class="status success">5 arquivos de teste carregados!</div>';
        };

        window.clearData = function() {
            testFiles = [];
            KC.AppState?.set('files', []);
            displayFiles();
            updateMetrics();
            document.getElementById('json-viewer').textContent = '';
            document.getElementById('before-schema').textContent = '';
            document.getElementById('after-schema').textContent = '';
            document.getElementById('system-status').innerHTML = 
                '<div class="status info">Dados limpos</div>';
        };

        window.enrichAllFiles = async function() {
            if (!KC.AnalysisManager?.enrichBatchWithSchemaOrg) {
                alert('AnalysisManager n√£o dispon√≠vel!');
                return;
            }

            const enrichedFiles = KC.AnalysisManager.enrichBatchWithSchemaOrg(testFiles);
            testFiles = enrichedFiles;
            KC.AppState?.set('files', testFiles);
            
            displayFiles();
            updateMetrics();
            
            // Mostra primeiro arquivo enriquecido como exemplo
            if (enrichedFiles[0]?.schemaOrg) {
                document.getElementById('json-viewer').textContent = 
                    JSON.stringify(enrichedFiles[0].schemaOrg, null, 2);
            }
        };

        window.showComparison = function() {
            if (testFiles.length === 0) {
                alert('Carregue os dados de teste primeiro!');
                return;
            }

            const fileExample = testFiles[0];
            
            // Antes (sem Schema.org)
            const before = {
                id: fileExample.id,
                name: fileExample.name,
                analysisType: fileExample.analysisType,
                categories: fileExample.categories,
                relevanceScore: fileExample.relevanceScore,
                metadata: {
                    created: fileExample.createdDate,
                    modified: fileExample.modifiedDate
                }
            };

            // Depois (com Schema.org)
            const after = fileExample.schemaOrg || KC.SchemaOrgMapper?.mapToSchema(fileExample);

            document.getElementById('before-schema').textContent = JSON.stringify(before, null, 2);
            document.getElementById('after-schema').textContent = JSON.stringify(after, null, 2);
        };

        window.exportAsJSON = async function() {
            if (!KC.RAGExportManager) {
                alert('RAGExportManager n√£o dispon√≠vel!');
                return;
            }

            try {
                const jsonData = await KC.RAGExportManager.exportData('json');
                downloadFile('export-knowledge.json', jsonData, 'application/json');
            } catch (error) {
                alert('Erro ao exportar: ' + error.message);
            }
        };

        window.exportAsJsonLD = async function() {
            if (!KC.RAGExportManager) {
                alert('RAGExportManager n√£o dispon√≠vel!');
                return;
            }

            try {
                const jsonldData = await KC.RAGExportManager.exportData('jsonld');
                downloadFile('export-knowledge.jsonld', jsonldData, 'application/ld+json');
            } catch (error) {
                alert('Erro ao exportar: ' + error.message);
            }
        };

        window.exportToQdrant = async function() {
            if (!KC.RAGExportManager) {
                alert('RAGExportManager n√£o dispon√≠vel!');
                return;
            }

            try {
                const qdrantData = await KC.RAGExportManager.exportData('qdrant');
                document.getElementById('json-viewer').textContent = 
                    JSON.stringify(qdrantData, null, 2);
                
                // Mostra estat√≠sticas
                const stats = {
                    collection: qdrantData.collection,
                    totalPoints: qdrantData.points.length,
                    withSchemaOrg: qdrantData.points.filter(p => p.payload.hasSemanticEnrichment).length
                };
                
                console.log('Estat√≠sticas Qdrant:', stats);
            } catch (error) {
                alert('Erro ao exportar: ' + error.message);
            }
        };

        window.validateSchemas = function() {
            if (!KC.SchemaOrgMapper?.validateSchema) {
                alert('M√©todo de valida√ß√£o n√£o dispon√≠vel!');
                return;
            }

            const results = testFiles.map(file => {
                if (!file.schemaOrg) return null;
                
                const isValid = KC.SchemaOrgMapper.validateSchema(file.schemaOrg);
                return {
                    file: file.name,
                    valid: isValid,
                    schema: file.schemaOrg
                };
            }).filter(Boolean);

            document.getElementById('json-viewer').textContent = 
                JSON.stringify(results, null, 2);
            
            const validCount = results.filter(r => r.valid).length;
            document.getElementById('system-status').innerHTML = 
                `<div class="status ${validCount === results.length ? 'success' : 'error'}">
                    Valida√ß√£o: ${validCount}/${results.length} schemas v√°lidos
                </div>`;
        };

        function displayFiles() {
            const fileList = document.getElementById('file-list');
            
            if (testFiles.length === 0) {
                fileList.innerHTML = '<p style="color: #999;">Nenhum arquivo carregado</p>';
                return;
            }

            fileList.innerHTML = testFiles.map(file => {
                const hasSchema = !!file.schemaOrg;
                const schemaType = file.schemaOrg?.['@type'] || '';
                
                return `
                    <div class="test-file ${hasSchema ? 'enriched' : ''}">
                        <div class="file-icon">üìÑ</div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">
                                ${file.analysisType} | ${Math.round(file.relevanceScore * 100)}% relev√¢ncia
                                ${file.categories ? ' | ' + file.categories.join(', ') : ''}
                            </div>
                        </div>
                        ${hasSchema ? `<div class="schema-type">${schemaType}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateMetrics() {
            const total = testFiles.length;
            const enriched = testFiles.filter(f => f.schemaOrg).length;
            const percentage = total > 0 ? Math.round((enriched / total) * 100) : 0;

            const metrics = document.getElementById('metrics');
            metrics.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Total de Arquivos</span>
                    <span class="metric-value">${total}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Enriquecidos com Schema.org</span>
                    <span class="metric-value">${enriched}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Taxa de Enriquecimento</span>
                    <span class="metric-value">${percentage}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Tipos Schema.org √önicos</span>
                    <span class="metric-value">${getUniqueSchemaTypes().length}</span>
                </div>
            `;

            // Atualiza barra de progresso
            const progressBar = document.getElementById('enrichment-progress');
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
        }

        function getUniqueSchemaTypes() {
            const types = new Set();
            testFiles.forEach(file => {
                if (file.schemaOrg?.['@type']) {
                    types.add(file.schemaOrg['@type']);
                }
            });
            return Array.from(types);
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            checkSystem();
            displayFiles();
            updateMetrics();
        });
    </script>

    <!-- Carrega os scripts necess√°rios -->
    <script src="js/core/EventBus.js"></script>
    <script src="js/utils/Logger.js"></script>
    <script src="js/core/AppState.js"></script>
    <script src="js/managers/SchemaOrgMapper.js"></script>
    <script src="js/managers/AnalysisManager.js"></script>
    <script src="js/managers/RAGExportManager.js"></script>
</body>
</html>