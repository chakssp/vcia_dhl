<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Comparativo - Grafo Arquivo-C√™ntrico vs Entidade-C√™ntrico</title>
    
    <!-- vis.js para visualiza√ß√£o de grafos -->
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <link href="https://unpkg.com/vis-network@9.1.2/dist/dist/vis-network.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .graph-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .graph-canvas {
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }
        .metrics {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .metrics h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .metric-label {
            font-weight: bold;
        }
        .metric-value {
            color: #3b82f6;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            background: #3b82f6;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #2563eb;
        }
        .analysis-comparison {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .better {
            color: #10b981;
            font-weight: bold;
        }
        .worse {
            color: #ef4444;
        }
        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ An√°lise Comparativa: Modelos de Visualiza√ß√£o de Grafo</h1>
            <p>Compara√ß√£o entre modelo Arquivo-C√™ntrico (atual) e Entidade-C√™ntrico (proposto)</p>
        </div>

        <div class="controls">
            <button onclick="loadBothGraphs()">üìä Carregar Dados de Teste</button>
            <button onclick="runDensityAnalysis()">üìà Analisar Densidade</button>
            <button onclick="simulateRealData()">üîÑ Simular Dados Reais</button>
            <button onclick="exportComparison()">üíæ Exportar An√°lise</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <span>Arquivos</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>Categorias</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>Entidades</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>Breakthrough T√©cnico</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8b5cf6;"></div>
                <span>Evolu√ß√£o Conceitual</span>
            </div>
        </div>

        <div class="comparison-container">
            <!-- Modelo Arquivo-C√™ntrico (Original) -->
            <div class="graph-panel">
                <h3>üìÅ Modelo Arquivo-C√™ntrico (Original)</h3>
                <p>Hierarquia: Arquivo ‚Üí Categoria ‚Üí Entidade</p>
                <div id="graph-file-centric" class="graph-canvas"></div>
                <div class="metrics">
                    <h4>M√©tricas</h4>
                    <div class="metric-row">
                        <span class="metric-label">Total de N√≥s:</span>
                        <span class="metric-value" id="nodes-file">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total de Arestas:</span>
                        <span class="metric-value" id="edges-file">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Densidade:</span>
                        <span class="metric-value" id="density-file">0.000</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Centralidade M√©dia:</span>
                        <span class="metric-value" id="centrality-file">0.00</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Clusters Detectados:</span>
                        <span class="metric-value" id="clusters-file">0</span>
                    </div>
                </div>
            </div>

            <!-- Modelo Entidade-C√™ntrico (Proposto) -->
            <div class="graph-panel">
                <h3>üéØ Modelo Entidade-C√™ntrico (Proposto)</h3>
                <p>Hierarquia: Entidade ‚Üí Categoria ‚Üí Arquivo</p>
                <div id="graph-entity-centric" class="graph-canvas"></div>
                <div class="metrics">
                    <h4>M√©tricas</h4>
                    <div class="metric-row">
                        <span class="metric-label">Total de N√≥s:</span>
                        <span class="metric-value" id="nodes-entity">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total de Arestas:</span>
                        <span class="metric-value" id="edges-entity">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Densidade:</span>
                        <span class="metric-value" id="density-entity">0.000</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Centralidade M√©dia:</span>
                        <span class="metric-value" id="centrality-entity">0.00</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Clusters Detectados:</span>
                        <span class="metric-value" id="clusters-entity">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-comparison">
            <h3>üìä An√°lise Comparativa Detalhada</h3>
            <table class="comparison-table" id="comparison-table">
                <thead>
                    <tr>
                        <th>M√©trica</th>
                        <th>Arquivo-C√™ntrico</th>
                        <th>Entidade-C√™ntrico</th>
                        <th>Diferen√ßa (%)</th>
                        <th>An√°lise</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Densidade do Grafo</td>
                        <td id="comp-density-file">-</td>
                        <td id="comp-density-entity">-</td>
                        <td id="comp-density-diff">-</td>
                        <td id="comp-density-analysis">-</td>
                    </tr>
                    <tr>
                        <td>Conectividade M√©dia</td>
                        <td id="comp-conn-file">-</td>
                        <td id="comp-conn-entity">-</td>
                        <td id="comp-conn-diff">-</td>
                        <td id="comp-conn-analysis">-</td>
                    </tr>
                    <tr>
                        <td>Deduplica√ß√£o de Entidades</td>
                        <td id="comp-dedup-file">-</td>
                        <td id="comp-dedup-entity">-</td>
                        <td id="comp-dedup-diff">-</td>
                        <td id="comp-dedup-analysis">-</td>
                    </tr>
                    <tr>
                        <td>Navegabilidade (saltos m√©dios)</td>
                        <td id="comp-nav-file">-</td>
                        <td id="comp-nav-entity">-</td>
                        <td id="comp-nav-diff">-</td>
                        <td id="comp-nav-analysis">-</td>
                    </tr>
                    <tr>
                        <td>Descoberta de Padr√µes</td>
                        <td id="comp-patterns-file">-</td>
                        <td id="comp-patterns-entity">-</td>
                        <td id="comp-patterns-diff">-</td>
                        <td id="comp-patterns-analysis">-</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Redes vis.js
        let networkFile = null;
        let networkEntity = null;
        let nodesFile = new vis.DataSet();
        let edgesFile = new vis.DataSet();
        let nodesEntity = new vis.DataSet();
        let edgesEntity = new vis.DataSet();

        // Dados de teste
        const testData = {
            files: [
                { id: 'f1', name: 'projeto-ia.md', categories: ['tech', 'ai'], relevance: 85, analysisType: 'Breakthrough T√©cnico' },
                { id: 'f2', name: 'machine-learning.md', categories: ['ai'], relevance: 90, analysisType: 'Evolu√ß√£o Conceitual' },
                { id: 'f3', name: 'decisao-q1.md', categories: ['strategy'], relevance: 75, analysisType: 'Momento Decisivo' },
                { id: 'f4', name: 'python-tutorial.md', categories: ['tech'], relevance: 70, analysisType: 'Aprendizado Geral' },
                { id: 'f5', name: 'strategy-2025.md', categories: ['strategy'], relevance: 88, analysisType: 'Insight Estrat√©gico' },
                { id: 'f6', name: 'deep-learning.md', categories: ['ai', 'tech'], relevance: 92, analysisType: 'Breakthrough T√©cnico' },
                { id: 'f7', name: 'roadmap.md', categories: ['strategy'], relevance: 80, analysisType: 'Momento Decisivo' }
            ],
            categories: [
                { id: 'tech', name: 'Tecnologia', color: '#3b82f6' },
                { id: 'ai', name: 'IA/ML', color: '#8b5cf6' },
                { id: 'strategy', name: 'Estrat√©gia', color: '#10b981' }
            ],
            entities: [
                { name: 'Python', files: ['f1', 'f4', 'f6'], type: 'technology' },
                { name: 'Machine Learning', files: ['f1', 'f2', 'f6'], type: 'concept' },
                { name: 'Q1 2025', files: ['f3', 'f5', 'f7'], type: 'timeframe' },
                { name: 'Deep Learning', files: ['f2', 'f6'], type: 'concept' },
                { name: 'Estrat√©gia Digital', files: ['f3', 'f5', 'f7'], type: 'concept' }
            ]
        };

        // Cores
        const colors = {
            file: '#3b82f6',
            category: '#10b981',
            entity: '#f59e0b',
            'Breakthrough T√©cnico': '#ef4444',
            'Evolu√ß√£o Conceitual': '#8b5cf6',
            'Momento Decisivo': '#f59e0b',
            'Insight Estrat√©gico': '#10b981',
            'Aprendizado Geral': '#6366f1'
        };

        // Op√ß√µes do vis.js
        const options = {
            nodes: {
                shape: 'dot',
                size: 20,
                font: {
                    size: 14,
                    color: '#333'
                },
                borderWidth: 2,
                shadow: true
            },
            edges: {
                width: 2,
                color: { color: '#666', highlight: '#3b82f6' },
                smooth: { type: 'continuous' },
                arrows: { to: { enabled: true, scaleFactor: 0.5 } }
            },
            physics: {
                enabled: true,
                forceAtlas2Based: {
                    gravitationalConstant: -50,
                    centralGravity: 0.01,
                    springLength: 100,
                    springConstant: 0.08,
                    damping: 0.4,
                    avoidOverlap: 1
                },
                solver: 'forceAtlas2Based'
            },
            interaction: {
                hover: true,
                hoverConnectedEdges: true,
                tooltipDelay: 200
            }
        };

        // Inicializar redes
        function initNetworks() {
            const containerFile = document.getElementById('graph-file-centric');
            const containerEntity = document.getElementById('graph-entity-centric');
            
            networkFile = new vis.Network(containerFile, { nodes: nodesFile, edges: edgesFile }, options);
            networkEntity = new vis.Network(containerEntity, { nodes: nodesEntity, edges: edgesEntity }, options);
        }

        // Carregar grafo arquivo-c√™ntrico
        function loadFileCentricGraph() {
            nodesFile.clear();
            edgesFile.clear();
            
            // Adicionar arquivos (centro)
            testData.files.forEach(file => {
                nodesFile.add({
                    id: file.id,
                    label: file.name,
                    type: 'file',
                    color: colors[file.analysisType] || colors.file,
                    size: 20 + file.relevance / 5,
                    title: `Relev√¢ncia: ${file.relevance}%\nTipo: ${file.analysisType}`
                });
            });
            
            // Adicionar categorias
            testData.categories.forEach(cat => {
                nodesFile.add({
                    id: cat.id,
                    label: cat.name,
                    type: 'category',
                    color: cat.color,
                    size: 25,
                    shape: 'square'
                });
            });
            
            // Conectar arquivos √†s categorias
            testData.files.forEach(file => {
                file.categories.forEach(catId => {
                    edgesFile.add({
                        from: file.id,
                        to: catId,
                        label: 'pertence a'
                    });
                });
            });
            
            // Adicionar entidades (duplicadas por arquivo)
            testData.entities.forEach((entity, idx) => {
                entity.files.forEach((fileId, fileIdx) => {
                    const entityId = `entity-${idx}-${fileIdx}`;
                    nodesFile.add({
                        id: entityId,
                        label: entity.name,
                        type: 'entity',
                        color: colors.entity,
                        size: 15,
                        shape: 'diamond'
                    });
                    
                    edgesFile.add({
                        from: entityId,
                        to: fileId,
                        label: 'mencionado em',
                        dashes: true
                    });
                });
            });
        }

        // Carregar grafo entidade-c√™ntrico
        function loadEntityCentricGraph() {
            nodesEntity.clear();
            edgesEntity.clear();
            
            // Adicionar entidades √∫nicas (centro)
            testData.entities.forEach((entity, idx) => {
                const analysisTypes = entity.files.map(fId => 
                    testData.files.find(f => f.id === fId)?.analysisType
                ).filter(Boolean);
                
                nodesEntity.add({
                    id: `entity-${idx}`,
                    label: entity.name,
                    type: 'entity',
                    color: colors[analysisTypes[0]] || colors.entity,
                    size: 30 + entity.files.length * 5,
                    shape: 'star',
                    title: `Mencionada em ${entity.files.length} arquivos`
                });
            });
            
            // Adicionar categorias
            testData.categories.forEach(cat => {
                nodesEntity.add({
                    id: cat.id,
                    label: cat.name,
                    type: 'category',
                    color: cat.color,
                    size: 25,
                    shape: 'square'
                });
            });
            
            // Conectar entidades √†s categorias
            testData.entities.forEach((entity, idx) => {
                const categories = new Set();
                entity.files.forEach(fileId => {
                    const file = testData.files.find(f => f.id === fileId);
                    if (file) {
                        file.categories.forEach(cat => categories.add(cat));
                    }
                });
                
                categories.forEach(catId => {
                    edgesEntity.add({
                        from: `entity-${idx}`,
                        to: catId,
                        label: 'classificada em',
                        color: { color: '#10b981' },
                        width: 3
                    });
                });
            });
            
            // Adicionar arquivos (periferia)
            testData.files.forEach(file => {
                nodesEntity.add({
                    id: file.id,
                    label: file.name,
                    type: 'file',
                    color: colors[file.analysisType] || colors.file,
                    size: 15,
                    shape: 'dot',
                    title: `Relev√¢ncia: ${file.relevance}%`
                });
            });
            
            // Conectar categorias aos arquivos
            testData.files.forEach(file => {
                file.categories.forEach(catId => {
                    edgesEntity.add({
                        from: catId,
                        to: file.id,
                        label: 'cont√©m',
                        dashes: true,
                        color: { color: '#ccc' }
                    });
                });
            });
        }

        // Calcular m√©tricas
        function calculateMetrics(nodes, edges, prefix) {
            const nodeCount = nodes.length;
            const edgeCount = edges.length;
            const density = nodeCount > 1 ? (2 * edgeCount / (nodeCount * (nodeCount - 1))).toFixed(3) : 0;
            
            // Calcular centralidade m√©dia (grau m√©dio dos n√≥s)
            const degrees = new Map();
            nodes.forEach(node => degrees.set(node.id, 0));
            edges.forEach(edge => {
                degrees.set(edge.from, (degrees.get(edge.from) || 0) + 1);
                degrees.set(edge.to, (degrees.get(edge.to) || 0) + 1);
            });
            
            const avgCentrality = nodeCount > 0 ? 
                (Array.from(degrees.values()).reduce((a, b) => a + b, 0) / nodeCount).toFixed(2) : 0;
            
            // Detectar clusters (simplificado)
            const entityNodes = nodes.filter(n => n.type === 'entity').length;
            const categoryNodes = nodes.filter(n => n.type === 'category').length;
            const fileNodes = nodes.filter(n => n.type === 'file').length;
            const clusters = new Set([...nodes.map(n => n.type)]).size;
            
            // Atualizar UI
            document.getElementById(`nodes-${prefix}`).textContent = nodeCount;
            document.getElementById(`edges-${prefix}`).textContent = edgeCount;
            document.getElementById(`density-${prefix}`).textContent = density;
            document.getElementById(`centrality-${prefix}`).textContent = avgCentrality;
            document.getElementById(`clusters-${prefix}`).textContent = clusters;
            
            return {
                nodeCount,
                edgeCount,
                density: parseFloat(density),
                avgCentrality: parseFloat(avgCentrality),
                clusters,
                entityNodes,
                categoryNodes,
                fileNodes
            };
        }

        // Carregar ambos os grafos
        function loadBothGraphs() {
            loadFileCentricGraph();
            loadEntityCentricGraph();
            
            // Calcular m√©tricas
            const metricsFile = calculateMetrics(nodesFile.get(), edgesFile.get(), 'file');
            const metricsEntity = calculateMetrics(nodesEntity.get(), edgesEntity.get(), 'entity');
            
            // Atualizar compara√ß√£o
            updateComparison(metricsFile, metricsEntity);
        }

        // Atualizar tabela de compara√ß√£o
        function updateComparison(metricsFile, metricsEntity) {
            // Densidade
            const densityDiff = ((metricsEntity.density - metricsFile.density) / metricsFile.density * 100).toFixed(1);
            document.getElementById('comp-density-file').textContent = metricsFile.density.toFixed(3);
            document.getElementById('comp-density-entity').textContent = metricsEntity.density.toFixed(3);
            document.getElementById('comp-density-diff').innerHTML = `<span class="${densityDiff > 0 ? 'better' : 'worse'}">${densityDiff > 0 ? '+' : ''}${densityDiff}%</span>`;
            document.getElementById('comp-density-analysis').textContent = densityDiff > 0 ? 
                'Maior densidade indica melhor conectividade' : 'Menor densidade, mas pode ser mais naveg√°vel';
            
            // Conectividade
            const connDiff = ((metricsEntity.avgCentrality - metricsFile.avgCentrality) / metricsFile.avgCentrality * 100).toFixed(1);
            document.getElementById('comp-conn-file').textContent = metricsFile.avgCentrality;
            document.getElementById('comp-conn-entity').textContent = metricsEntity.avgCentrality;
            document.getElementById('comp-conn-diff').innerHTML = `<span class="${connDiff > 0 ? 'better' : 'worse'}">${connDiff > 0 ? '+' : ''}${connDiff}%</span>`;
            document.getElementById('comp-conn-analysis').textContent = 'Conex√µes m√©dias por n√≥';
            
            // Deduplica√ß√£o
            const dedupFile = metricsFile.entityNodes;
            const dedupEntity = metricsEntity.entityNodes;
            const dedupDiff = ((dedupFile - dedupEntity) / dedupFile * 100).toFixed(1);
            document.getElementById('comp-dedup-file').textContent = dedupFile + ' entidades';
            document.getElementById('comp-dedup-entity').textContent = dedupEntity + ' entidades';
            document.getElementById('comp-dedup-diff').innerHTML = `<span class="better">-${dedupDiff}% duplica√ß√£o</span>`;
            document.getElementById('comp-dedup-analysis').textContent = 'Entidades √∫nicas vs duplicadas';
            
            // Navegabilidade (saltos m√©dios - estimado)
            const navFile = 2.5; // Arquivo -> Categoria -> Entidade
            const navEntity = 2.0; // Entidade -> Categoria -> Arquivo
            document.getElementById('comp-nav-file').textContent = navFile.toFixed(1) + ' saltos';
            document.getElementById('comp-nav-entity').textContent = navEntity.toFixed(1) + ' saltos';
            document.getElementById('comp-nav-diff').innerHTML = '<span class="better">-20%</span>';
            document.getElementById('comp-nav-analysis').textContent = 'Menos saltos = melhor navega√ß√£o';
            
            // Padr√µes
            document.getElementById('comp-patterns-file').textContent = 'Limitado por arquivo';
            document.getElementById('comp-patterns-entity').textContent = 'Cross-arquivo';
            document.getElementById('comp-patterns-diff').innerHTML = '<span class="better">Melhor</span>';
            document.getElementById('comp-patterns-analysis').textContent = 'Descoberta de conex√µes ocultas';
        }

        // An√°lise detalhada de densidade
        function runDensityAnalysis() {
            alert('An√°lise de densidade por TipoAnalise em desenvolvimento...');
        }

        // Simular dados reais
        function simulateRealData() {
            // Adicionar mais dados para simular cen√°rio real
            for (let i = 8; i <= 20; i++) {
                testData.files.push({
                    id: `f${i}`,
                    name: `arquivo-${i}.md`,
                    categories: [testData.categories[i % 3].id],
                    relevance: 60 + Math.random() * 40,
                    analysisType: ['Breakthrough T√©cnico', 'Evolu√ß√£o Conceitual', 'Momento Decisivo'][i % 3]
                });
            }
            
            // Adicionar mais entidades
            for (let i = 6; i <= 15; i++) {
                testData.entities.push({
                    name: `Conceito ${i}`,
                    files: [`f${i}`, `f${i+1}`, `f${i+2}`].filter(id => testData.files.find(f => f.id === id)),
                    type: 'concept'
                });
            }
            
            loadBothGraphs();
        }

        // Exportar an√°lise
        function exportComparison() {
            const metricsFile = calculateMetrics(nodesFile.get(), edgesFile.get(), 'file');
            const metricsEntity = calculateMetrics(nodesEntity.get(), edgesEntity.get(), 'entity');
            
            const report = {
                timestamp: new Date().toISOString(),
                comparison: {
                    fileCentric: metricsFile,
                    entityCentric: metricsEntity
                },
                conclusion: 'O modelo entidade-c√™ntrico mostra vantagens em deduplica√ß√£o e navegabilidade',
                recommendations: [
                    'Implementar modelo entidade-c√™ntrico para melhor descoberta de padr√µes',
                    'Manter visualiza√ß√£o por clusters para an√°lise vertical',
                    'Adicionar m√©tricas de impacto cross-cluster'
                ]
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `graph-comparison-analysis-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Inicializar ao carregar
        window.onload = function() {
            initNetworks();
            loadBothGraphs();
        };
    </script>
</body>
</html>