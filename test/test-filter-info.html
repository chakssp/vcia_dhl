<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Informa√ß√µes de Filtros na Bulk Actions Bar</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4f46e5;
            padding-bottom: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #f0f0f0;
            border-color: #4f46e5;
        }
        
        .success { background: #10b981; color: white; border-color: #10b981; }
        .success:hover { background: #059669; }
        
        .warning { background: #f59e0b; color: white; border-color: #f59e0b; }
        .warning:hover { background: #d97706; }
        
        .info { background: #3b82f6; color: white; border-color: #3b82f6; }
        .info:hover { background: #2563eb; }
        
        .mock-container {
            border: 2px dashed #ddd;
            padding: 20px;
            border-radius: 8px;
            min-height: 300px;
            position: relative;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 13px;
        }
        
        .status.success { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .status.info { background: #dbeafe; color: #1e3a8a; }
        
        code {
            background: #f3f4f6;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .file-entry {
            padding: 10px;
            margin: 5px 0;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .file-entry:hover {
            border-color: #4f46e5;
            background: #f0f9ff;
        }
        
        .file-entry.selected {
            background: #dbeafe;
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste - Informa√ß√µes de Filtros na Bulk Actions Bar</h1>
    
    <div class="test-section">
        <h2>üìã Cen√°rios de Teste</h2>
        
        <div class="test-controls">
            <button onclick="testScenario1()" class="info">
                Cen√°rio 1: Sem Filtros (100 arquivos)
            </button>
            <button onclick="testScenario2()" class="warning">
                Cen√°rio 2: Filtros Ativos (45 de 100)
            </button>
            <button onclick="testScenario3()" class="success">
                Cen√°rio 3: Eventos de Filtro
            </button>
            <button onclick="testScenario4()">
                Cen√°rio 4: Sele√ß√£o + Filtros
            </button>
        </div>
        
        <div id="test-status"></div>
    </div>
    
    <div class="test-section">
        <h2>üéØ Mock da Interface</h2>
        <div class="mock-container">
            <div id="files-header"></div>
            <div id="mock-files"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìä Valida√ß√µes</h2>
        <div id="validations"></div>
    </div>

    <script>
        // Simula√ß√£o b√°sica do ambiente KC
        window.KC = {
            Events: {
                FILES_UPDATED: 'files_updated',
                FILTERS_CHANGED: 'filters_changed'
            },
            EventBus: {
                listeners: {},
                on(event, callback) {
                    if (!this.listeners[event]) this.listeners[event] = [];
                    this.listeners[event].push(callback);
                },
                emit(event, data) {
                    if (this.listeners[event]) {
                        this.listeners[event].forEach(cb => cb(data));
                    }
                }
            },
            AppState: {
                data: { files: [] },
                get(key) { return this.data[key]; },
                set(key, value) { this.data[key] = value; }
            },
            FilterPanel: {
                getFilteredFilesCount() {
                    return this._filteredCount || 100;
                },
                _filteredCount: 100
            }
        };
        
        // Mock do FileRenderer
        class MockFileRenderer {
            constructor() {
                this.selectedFiles = new Set();
                this.filteredFiles = [];
                this.originalFiles = [];
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                KC.EventBus.on(KC.Events.FILES_UPDATED, () => {
                    this.updateFilterInfo();
                });
                
                KC.EventBus.on(KC.Events.FILTERS_CHANGED, () => {
                    this.updateFilterInfo();
                });
            }
            
            updateBulkActionsBar() {
                const container = document.getElementById('files-header');
                if (!container) return;
                
                const count = this.selectedFiles.size;
                
                container.innerHTML = `
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0 0 5px 0;">Arquivos Descobertos</h3>
                            <div style="font-size: 14px;">
                                <span style="font-weight: 600;">${count} arquivo(s) selecionado(s)</span>
                                <span id="bulk-filter-info" style="margin-left: 15px; color: #666;"></span>
                            </div>
                        </div>
                        <div>
                            <button onclick="clearSelection()">‚ùå Limpar Sele√ß√£o</button>
                        </div>
                    </div>
                `;
                
                this.updateFilterInfo();
            }
            
            updateFilterInfo() {
                const filterInfo = document.getElementById('bulk-filter-info');
                if (!filterInfo) return;
                
                if (KC.FilterPanel && KC.FilterPanel.getFilteredFilesCount) {
                    const filteredCount = KC.FilterPanel.getFilteredFilesCount();
                    const totalFiles = (KC.AppState.get('files') || []).length;
                    
                    if (filteredCount < totalFiles) {
                        filterInfo.textContent = `‚Ä¢ ${filteredCount} de ${totalFiles} arquivos (filtros ativos)`;
                        filterInfo.style.color = '#f59e0b';
                    } else {
                        filterInfo.textContent = `‚Ä¢ ${totalFiles} arquivos totais`;
                        filterInfo.style.color = '#666';
                    }
                } else if (this.filteredFiles.length > 0) {
                    const filteredCount = this.filteredFiles.length;
                    const totalFiles = this.originalFiles.length;
                    
                    if (filteredCount < totalFiles) {
                        filterInfo.textContent = `‚Ä¢ ${filteredCount} de ${totalFiles} arquivos vis√≠veis`;
                        filterInfo.style.color = '#f59e0b';
                    } else {
                        filterInfo.textContent = `‚Ä¢ ${totalFiles} arquivos`;
                        filterInfo.style.color = '#666';
                    }
                }
                
                logValidation('updateFilterInfo executado', filterInfo.textContent || 'Vazio');
            }
        }
        
        const fileRenderer = new MockFileRenderer();
        
        // Fun√ß√µes de teste
        function testScenario1() {
            updateStatus('info', 'üß™ Cen√°rio 1: Simulando 100 arquivos sem filtros...');
            
            // Simula 100 arquivos
            const files = Array.from({length: 100}, (_, i) => ({
                id: i,
                name: `arquivo_${i}.md`
            }));
            
            KC.AppState.set('files', files);
            KC.FilterPanel._filteredCount = 100;
            
            // Atualiza interface
            fileRenderer.updateBulkActionsBar();
            renderMockFiles(files);
            
            updateStatus('success', '‚úÖ Cen√°rio 1 executado: 100 arquivos totais');
        }
        
        function testScenario2() {
            updateStatus('info', 'üß™ Cen√°rio 2: Aplicando filtros (45 de 100 vis√≠veis)...');
            
            // Simula 100 arquivos
            const files = Array.from({length: 100}, (_, i) => ({
                id: i,
                name: `arquivo_${i}.md`
            }));
            
            KC.AppState.set('files', files);
            KC.FilterPanel._filteredCount = 45;
            
            // Atualiza interface
            fileRenderer.updateBulkActionsBar();
            renderMockFiles(files.slice(0, 45));
            
            updateStatus('success', '‚úÖ Cen√°rio 2 executado: 45 de 100 arquivos (filtros ativos)');
        }
        
        function testScenario3() {
            updateStatus('info', 'üß™ Cen√°rio 3: Testando eventos...');
            
            // Estado inicial
            const files = Array.from({length: 50}, (_, i) => ({
                id: i,
                name: `arquivo_${i}.md`
            }));
            
            KC.AppState.set('files', files);
            KC.FilterPanel._filteredCount = 50;
            fileRenderer.updateBulkActionsBar();
            
            // Emite evento FILES_UPDATED
            setTimeout(() => {
                updateStatus('info', 'üì° Emitindo FILES_UPDATED...');
                KC.EventBus.emit(KC.Events.FILES_UPDATED, {});
            }, 1000);
            
            // Emite evento FILTERS_CHANGED
            setTimeout(() => {
                updateStatus('info', 'üì° Emitindo FILTERS_CHANGED...');
                KC.FilterPanel._filteredCount = 25;
                KC.EventBus.emit(KC.Events.FILTERS_CHANGED, {});
            }, 2000);
            
            setTimeout(() => {
                updateStatus('success', '‚úÖ Cen√°rio 3 executado: Eventos testados');
            }, 3000);
        }
        
        function testScenario4() {
            updateStatus('info', 'üß™ Cen√°rio 4: Sele√ß√£o + Filtros...');
            
            const files = Array.from({length: 80}, (_, i) => ({
                id: i,
                name: `arquivo_${i}.md`
            }));
            
            KC.AppState.set('files', files);
            KC.FilterPanel._filteredCount = 30;
            
            // Simula sele√ß√£o
            fileRenderer.selectedFiles.add(1);
            fileRenderer.selectedFiles.add(5);
            fileRenderer.selectedFiles.add(10);
            
            fileRenderer.updateBulkActionsBar();
            renderMockFiles(files.slice(0, 30));
            
            updateStatus('success', '‚úÖ Cen√°rio 4 executado: 3 selecionados, 30 de 80 vis√≠veis');
        }
        
        // Fun√ß√µes auxiliares
        function updateStatus(type, message) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function logValidation(action, detail) {
            const validations = document.getElementById('validations');
            const timestamp = new Date().toLocaleTimeString();
            validations.innerHTML += `
                <div class="status info" style="margin: 5px 0;">
                    <strong>[${timestamp}]</strong> ${action}: <code>${detail}</code>
                </div>
            `;
        }
        
        function renderMockFiles(files) {
            const container = document.getElementById('mock-files');
            container.innerHTML = files.slice(0, 10).map(file => `
                <div class="file-entry" onclick="toggleSelection(${file.id})">
                    üìÑ ${file.name}
                </div>
            `).join('');
            
            if (files.length > 10) {
                container.innerHTML += `<div style="text-align: center; padding: 10px; color: #666;">
                    ... e mais ${files.length - 10} arquivos
                </div>`;
            }
        }
        
        function toggleSelection(id) {
            const entry = event.target;
            entry.classList.toggle('selected');
            
            if (fileRenderer.selectedFiles.has(id)) {
                fileRenderer.selectedFiles.delete(id);
            } else {
                fileRenderer.selectedFiles.add(id);
            }
            
            fileRenderer.updateBulkActionsBar();
            logValidation('Arquivo toggleado', `ID ${id}, Total selecionados: ${fileRenderer.selectedFiles.size}`);
        }
        
        function clearSelection() {
            fileRenderer.selectedFiles.clear();
            document.querySelectorAll('.file-entry').forEach(e => e.classList.remove('selected'));
            fileRenderer.updateBulkActionsBar();
            logValidation('Sele√ß√£o limpa', '0 arquivos selecionados');
        }
        
        // Inicializa√ß√£o
        window.onload = () => {
            updateStatus('info', 'üöÄ Sistema de teste pronto! Escolha um cen√°rio acima.');
            fileRenderer.updateBulkActionsBar();
        };
    </script>
</body>
</html>