<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Diagnóstico KC</title>
</head>
<body>
    <h1>Diagnóstico do Sistema</h1>
    <pre id="output"></pre>
    
    <script>
        // Função para capturar console.log
        const output = document.getElementById('output');
        const originalLog = console.log;
        console.log = function(...args) {
            output.textContent += args.join(' ') + '\n';
            originalLog.apply(console, args);
        };

        // Aguardar carregamento da página principal
        setTimeout(() => {
            // Acessar o iframe da página principal
            const iframe = document.createElement('iframe');
            iframe.src = 'http://127.0.0.1:5500';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                const iframeWindow = iframe.contentWindow;
                
                // Executar diagnóstico
                if (iframeWindow.kcdiag) {
                    console.log('=== EXECUTANDO KCDIAG ===');
                    iframeWindow.kcdiag();
                } else {
                    console.log('ERRO: kcdiag não encontrado');
                }
                
                // Verificar estado
                if (iframeWindow.KC && iframeWindow.KC.AppState) {
                    console.log('\n=== ESTADO DO SISTEMA ===');
                    const files = iframeWindow.KC.AppState.get('files');
                    console.log('Arquivos no estado:', files ? files.length : 0);
                    
                    const categories = iframeWindow.KC.AppState.get('categories');
                    console.log('Categorias:', categories ? categories.length : 0);
                    
                    console.log('\n=== VERIFICANDO SERVIÇOS ===');
                    // Verificar Qdrant
                    if (iframeWindow.KC.QdrantService) {
                        iframeWindow.KC.QdrantService.checkConnection().then(result => {
                            console.log('Qdrant:', result ? 'Conectado' : 'Desconectado');
                        });
                    }
                    
                    // Verificar Ollama
                    if (iframeWindow.KC.EmbeddingService) {
                        iframeWindow.KC.EmbeddingService.checkOllamaAvailability().then(result => {
                            console.log('Ollama:', result ? 'Disponível' : 'Indisponível');
                        });
                    }
                }
            };
        }, 1000);
    </script>
</body>
</html>