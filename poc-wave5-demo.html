<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave 5 POC - ML Confidence Integration Demo</title>
    
    <style>
        /* POC Demo Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .poc-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .poc-header h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        
        .poc-header p {
            margin: 0;
            opacity: 0.9;
        }
        
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-panel h2 {
            margin-top: 0;
            color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .status-card.active {
            border-color: #667eea;
            background: #f0f2ff;
        }
        
        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .status-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .demo-files {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .file-categories {
            font-size: 0.9em;
            color: #666;
        }
        
        .confidence-badge-poc {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .confidence-value {
            font-size: 1.1em;
        }
        
        .iteration {
            opacity: 0.8;
            font-size: 0.9em;
        }
        
        .ml-dashboard-poc {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-card h3 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-target {
            font-size: 0.9em;
            color: #999;
        }
        
        .activity-log {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .activity-log h3 {
            margin: 0 0 10px 0;
            color: #666;
        }
        
        .activity-log ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .activity-log li {
            padding: 5px 0;
            font-size: 0.9em;
            color: #666;
            border-bottom: 1px solid #e9ecef;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .success-message.show {
            display: flex;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .console-output pre {
            margin: 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <!-- POC Header -->
    <div class="poc-header">
        <h1>üöÄ Wave 5 POC - ML Confidence Integration</h1>
        <p>Demonstra√ß√£o da integra√ß√£o dos componentes ML no Knowledge Consolidator</p>
    </div>

    <!-- Success Message -->
    <div id="success-message" class="success-message">
        <span>‚úÖ</span>
        <span id="success-text">Opera√ß√£o conclu√≠da com sucesso!</span>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <h2>üéÆ Painel de Controle</h2>
        <div class="button-group">
            <button onclick="POCDemo.runValidation()">
                üîç Executar Valida√ß√£o
            </button>
            <button onclick="POCDemo.initializeML()" id="init-btn">
                ü§ñ Inicializar ML
            </button>
            <button onclick="POCDemo.loadDemoFiles()" id="load-btn" disabled>
                üìÅ Carregar Arquivos Demo
            </button>
            <button onclick="POCDemo.runAnalysis()" id="analyze-btn" disabled>
                üß™ Analisar com ML
            </button>
            <button onclick="POCDemo.simulateIteration()" id="iterate-btn" disabled>
                üîÑ Simular Itera√ß√£o
            </button>
            <button onclick="POCDemo.showDashboard()" id="dashboard-btn" disabled>
                üìä Mostrar Dashboard
            </button>
            <button onclick="POCDemo.reset()">
                üîÑ Resetar Demo
            </button>
        </div>
    </div>

    <!-- Status Panel -->
    <div class="status-panel">
        <h2>üìä Status do Sistema</h2>
        <div class="status-grid">
            <div class="status-card" id="status-validation">
                <div class="status-label">Valida√ß√£o</div>
                <div class="status-value">--</div>
            </div>
            <div class="status-card" id="status-ml">
                <div class="status-label">ML Components</div>
                <div class="status-value">--</div>
            </div>
            <div class="status-card" id="status-files">
                <div class="status-label">Arquivos</div>
                <div class="status-value">0</div>
            </div>
            <div class="status-card" id="status-confidence">
                <div class="status-label">Confian√ßa M√©dia</div>
                <div class="status-value">--%</div>
            </div>
        </div>
    </div>

    <!-- Demo Files -->
    <div class="demo-files" id="demo-files" style="display: none;">
        <h2>üìÑ Arquivos de Demonstra√ß√£o</h2>
        <div id="files-container">
            <!-- Files will be inserted here -->
        </div>
    </div>

    <!-- ML Dashboard -->
    <div id="ml-dashboard" class="ml-dashboard-poc" style="display: none;">
        <!-- Dashboard will be inserted here -->
    </div>

    <!-- Console Output -->
    <div class="control-panel">
        <h2>üñ•Ô∏è Console Output</h2>
        <div class="console-output" id="console-output">
            <pre>POC Wave 5 - Ready to start...
Click "Executar Valida√ß√£o" to begin.</pre>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Mock KC object for POC
        window.KC = window.KC || {
            EventBus: {
                events: {},
                on(event, handler) {
                    if (!this.events[event]) this.events[event] = [];
                    this.events[event].push(handler);
                },
                off(event, handler) {
                    if (!this.events[event]) return;
                    this.events[event] = this.events[event].filter(h => h !== handler);
                },
                emit(event, data) {
                    if (!this.events[event]) return;
                    this.events[event].forEach(handler => handler(data));
                },
                once(event, handler) {
                    const onceHandler = (data) => {
                        handler(data);
                        this.off(event, onceHandler);
                    };
                    this.on(event, onceHandler);
                }
            },
            
            AppState: {
                state: {},
                get(key) { return this.state[key]; },
                set(key, value) { 
                    this.state[key] = value;
                    KC.EventBus.emit('state:changed', { key, value });
                }
            },
            
            AnalysisManager: {
                analyze: async function(files) {
                    // Mock analysis
                    return files.map(f => ({ ...f, analyzed: true }));
                }
            },
            
            // Other mock components
            FilterManager: {},
            WorkflowPanel: {},
            FileRenderer: {},
            AppController: {}
        };

        // POC Demo Controller
        window.POCDemo = {
            initialized: false,
            demoFiles: [],
            
            log(message, type = 'info') {
                const output = document.getElementById('console-output');
                const pre = output.querySelector('pre');
                const timestamp = new Date().toLocaleTimeString();
                const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
                pre.textContent += `\n[${timestamp}] ${prefix} ${message}`;
                output.scrollTop = output.scrollHeight;
            },
            
            showSuccess(message) {
                const successEl = document.getElementById('success-message');
                document.getElementById('success-text').textContent = message;
                successEl.classList.add('show');
                setTimeout(() => successEl.classList.remove('show'), 3000);
            },
            
            updateStatus(cardId, value, active = false) {
                const card = document.getElementById(cardId);
                card.querySelector('.status-value').textContent = value;
                if (active) {
                    document.querySelectorAll('.status-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                }
            },
            
            async runValidation() {
                this.log('Starting validation...');
                this.updateStatus('status-validation', '...', true);
                
                // Load and run validation script
                const script = document.createElement('script');
                script.src = 'poc-wave5-validation.js';
                script.onload = () => {
                    setTimeout(() => {
                        const validation = window.POC_VALIDATION;
                        if (validation) {
                            this.updateStatus('status-validation', `${validation.readiness.percentage}%`);
                            this.log(`Validation complete: ${validation.readiness.percentage}% ready`, 'success');
                            document.getElementById('init-btn').disabled = false;
                            this.showSuccess('Valida√ß√£o conclu√≠da!');
                        }
                    }, 1000);
                };
                document.body.appendChild(script);
            },
            
            initializeML() {
                this.log('Initializing ML components...');
                this.updateStatus('status-ml', '...', true);
                
                // Initialize POC ML components
                KC.ML = {
                    calculator: {
                        calculate(file) {
                            const base = 0.5 + Math.random() * 0.3;
                            return {
                                overall: base,
                                dimensions: {
                                    semantic: base + 0.1,
                                    categorical: base - 0.05,
                                    structural: base,
                                    temporal: base + 0.05
                                }
                            };
                        }
                    },
                    
                    tracker: {
                        history: new Map(),
                        track(fileId, confidence, iteration) {
                            if (!this.history.has(fileId)) {
                                this.history.set(fileId, []);
                            }
                            this.history.get(fileId).push({ confidence, iteration });
                            KC.EventBus.emit('confidence:updated', { fileId, confidence, iteration });
                        }
                    }
                };
                
                // Extend AppState
                KC.AppState.ml = {
                    enabled: true,
                    metrics: { avgConfidence: 0, totalIterations: 0 }
                };
                
                setTimeout(() => {
                    this.updateStatus('status-ml', '‚úÖ Ready');
                    this.log('ML components initialized successfully', 'success');
                    document.getElementById('load-btn').disabled = false;
                    this.initialized = true;
                    this.showSuccess('ML inicializado com sucesso!');
                }, 1000);
            },
            
            loadDemoFiles() {
                this.log('Loading demo files...');
                this.updateStatus('status-files', '...', true);
                
                this.demoFiles = [
                    {
                        id: 'demo-1',
                        name: 'strategic-insight.md',
                        content: 'Key insight: Digital transformation requires organizational change...',
                        categories: ['strategy', 'transformation']
                    },
                    {
                        id: 'demo-2', 
                        name: 'technical-decision.md',
                        content: 'Decision: Adopt microservices architecture for scalability...',
                        categories: ['technical', 'architecture']
                    },
                    {
                        id: 'demo-3',
                        name: 'project-notes.md',
                        content: 'Project kickoff meeting notes and action items...',
                        categories: []
                    }
                ];
                
                KC.AppState.set('files', this.demoFiles);
                
                setTimeout(() => {
                    this.updateStatus('status-files', this.demoFiles.length);
                    this.renderFiles();
                    this.log(`Loaded ${this.demoFiles.length} demo files`, 'success');
                    document.getElementById('analyze-btn').disabled = false;
                    this.showSuccess('Arquivos carregados!');
                }, 500);
            },
            
            renderFiles() {
                const container = document.getElementById('files-container');
                container.innerHTML = '';
                
                this.demoFiles.forEach(file => {
                    const fileEl = document.createElement('div');
                    fileEl.className = 'file-item';
                    fileEl.id = `file-${file.id}`;
                    
                    const infoHtml = `
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-categories">
                                ${file.categories.length > 0 
                                    ? file.categories.map(c => `<span>#${c}</span>`).join(' ')
                                    : '<span style="color: #999;">sem categorias</span>'}
                            </div>
                        </div>
                    `;
                    
                    const badgeHtml = file.confidence 
                        ? this.createConfidenceBadge(file.confidence, file.iteration)
                        : '<span style="color: #999;">n√£o analisado</span>';
                    
                    fileEl.innerHTML = infoHtml + badgeHtml;
                    container.appendChild(fileEl);
                });
                
                document.getElementById('demo-files').style.display = 'block';
            },
            
            createConfidenceBadge(confidence, iteration = 1) {
                const color = confidence.overall >= 0.85 ? '#4CAF50' 
                           : confidence.overall >= 0.70 ? '#FFC107' 
                           : '#F44336';
                
                return `
                    <div class="confidence-badge-poc" style="background-color: ${color};">
                        <span class="confidence-value">${Math.round(confidence.overall * 100)}%</span>
                        ${iteration > 1 ? `<span class="iteration">v${iteration}</span>` : ''}
                    </div>
                `;
            },
            
            async runAnalysis() {
                this.log('Starting ML analysis...');
                this.updateStatus('status-confidence', '...', true);
                
                // Analyze each file
                for (let i = 0; i < this.demoFiles.length; i++) {
                    const file = this.demoFiles[i];
                    this.log(`Analyzing ${file.name}...`);
                    
                    // Calculate confidence
                    file.confidence = KC.ML.calculator.calculate(file);
                    file.iteration = 1;
                    
                    // Track confidence
                    KC.ML.tracker.track(file.id, file.confidence, file.iteration);
                    
                    // Update UI
                    const fileEl = document.getElementById(`file-${file.id}`);
                    if (fileEl) {
                        const badge = this.createConfidenceBadge(file.confidence, file.iteration);
                        fileEl.innerHTML = fileEl.querySelector('.file-info').outerHTML + badge;
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // Calculate average confidence
                const avgConfidence = this.demoFiles.reduce((sum, f) => sum + f.confidence.overall, 0) / this.demoFiles.length;
                this.updateStatus('status-confidence', `${Math.round(avgConfidence * 100)}%`);
                
                this.log('ML analysis complete', 'success');
                document.getElementById('iterate-btn').disabled = false;
                document.getElementById('dashboard-btn').disabled = false;
                this.showSuccess('An√°lise conclu√≠da!');
            },
            
            async simulateIteration() {
                this.log('Running iterative improvement...');
                
                for (let file of this.demoFiles) {
                    if (file.confidence.overall < 0.85) {
                        this.log(`Improving ${file.name}...`);
                        
                        // Simulate improvement
                        const improvement = 0.1 + Math.random() * 0.1;
                        file.confidence.overall = Math.min(file.confidence.overall + improvement, 0.95);
                        file.iteration = (file.iteration || 1) + 1;
                        
                        // Track new confidence
                        KC.ML.tracker.track(file.id, file.confidence, file.iteration);
                        
                        // Update UI
                        const fileEl = document.getElementById(`file-${file.id}`);
                        if (fileEl) {
                            const badge = this.createConfidenceBadge(file.confidence, file.iteration);
                            fileEl.innerHTML = fileEl.querySelector('.file-info').outerHTML + badge;
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                }
                
                // Update average
                const avgConfidence = this.demoFiles.reduce((sum, f) => sum + f.confidence.overall, 0) / this.demoFiles.length;
                this.updateStatus('status-confidence', `${Math.round(avgConfidence * 100)}%`);
                
                this.log('Iterative improvement complete', 'success');
                this.showSuccess('Melhoria iterativa conclu√≠da!');
            },
            
            showDashboard() {
                const dashboard = document.getElementById('ml-dashboard');
                
                // Calculate metrics
                const avgConfidence = this.demoFiles.reduce((sum, f) => sum + (f.confidence?.overall || 0), 0) / this.demoFiles.length;
                const totalIterations = this.demoFiles.reduce((sum, f) => sum + (f.iteration || 0), 0);
                const converged = this.demoFiles.filter(f => f.confidence?.overall >= 0.85).length;
                
                dashboard.innerHTML = `
                    <h2>üìä ML Confidence Dashboard</h2>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <h3>Confian√ßa M√©dia</h3>
                            <div class="metric-value">${Math.round(avgConfidence * 100)}%</div>
                            <div class="metric-target">Target: 85%</div>
                        </div>
                        
                        <div class="metric-card">
                            <h3>Arquivos</h3>
                            <div class="metric-value">${this.demoFiles.length}</div>
                        </div>
                        
                        <div class="metric-card">
                            <h3>Itera√ß√µes</h3>
                            <div class="metric-value">${totalIterations}</div>
                        </div>
                        
                        <div class="metric-card">
                            <h3>Convergidos</h3>
                            <div class="metric-value">${converged}</div>
                        </div>
                    </div>
                    
                    <div class="activity-log">
                        <h3>Atividade Recente</h3>
                        <ul id="activity-list">
                            <li>[${new Date().toLocaleTimeString()}] Dashboard carregado</li>
                        </ul>
                    </div>
                `;
                
                dashboard.style.display = 'block';
                this.log('Dashboard loaded', 'success');
                this.showSuccess('Dashboard carregado!');
            },
            
            reset() {
                this.log('Resetting demo...');
                
                // Reset state
                this.initialized = false;
                this.demoFiles = [];
                KC.ML = undefined;
                KC.AppState.ml = undefined;
                KC.AppState.set('files', []);
                
                // Reset UI
                document.getElementById('demo-files').style.display = 'none';
                document.getElementById('ml-dashboard').style.display = 'none';
                
                // Reset buttons
                document.getElementById('init-btn').disabled = true;
                document.getElementById('load-btn').disabled = true;
                document.getElementById('analyze-btn').disabled = true;
                document.getElementById('iterate-btn').disabled = true;
                document.getElementById('dashboard-btn').disabled = true;
                
                // Reset status
                this.updateStatus('status-validation', '--');
                this.updateStatus('status-ml', '--');
                this.updateStatus('status-files', '0');
                this.updateStatus('status-confidence', '--%');
                
                this.log('Demo reset complete', 'success');
                this.showSuccess('Demo resetado!');
            }
        };
        
        // Initialize
        console.log('POC Wave 5 Demo loaded successfully!');
    </script>
</body>
</html>